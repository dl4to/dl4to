---

title: Equivariance


keywords: fastai
sidebar: home_sidebar



nb_path: "notebooks/models/5_equivariance.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/models/5_equivariance.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="EquivarianceWrapper" class="doc_header"><code>class</code> <code>EquivarianceWrapper</code><a href="dl4to/models.py#L822" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>EquivarianceWrapper</code>(<strong><code>preprocessing</code></strong>:<code>dl4to.preprocessing.Preprocessing</code>=<em><code>None</code></em>, <strong><code>rotate</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>mirror</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>dim</code></strong>:<code>int</code>=<em><code>2</code></em>, <strong><code>rotate_twice</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>sample_rate</code></strong>:<code>float</code>=<em><code>1.0</code></em>)</p>
</blockquote>
<p>A class that represents an equivariance wrapper [1] that implements group equivariance via group averaging [2].</p>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>preprocessing</code></strong></td>
<td><code>dl4to.preprocessing.Preprocessing</code></td>
<td><code>None</code></td>
<td>The preprocessing strategy to use. This is used in the equivariance wrapper to obtain the scalar and vector field information of the input.</td>
</tr>
<tr>
<td><strong><code>rotate</code></strong></td>
<td><code>bool</code></td>
<td><code>True</code></td>
<td>Whether to include rotational equivariance in the transformation group.</td>
</tr>
<tr>
<td><strong><code>mirror</code></strong></td>
<td><code>bool</code></td>
<td><code>True</code></td>
<td>Whether to include mirror equivariance in the transformation group.</td>
</tr>
<tr>
<td><strong><code>dim</code></strong></td>
<td><code>int</code></td>
<td><code>2</code></td>
<td>The dimension of the transformation group. Specifically, a 2d transformation group does not consider rotations and mirrors along the z-axis.</td>
</tr>
<tr>
<td><strong><code>rotate_twice</code></strong></td>
<td><code>bool</code></td>
<td><code>False</code></td>
<td>Whether double-rotations should be used, where the input is rotated twice, along two different axes. This may result in a larger transformation group.</td>
</tr>
<tr>
<td><strong><code>sample_rate</code></strong></td>
<td><code>float</code></td>
<td><code>1.0</code></td>
<td>The rate of transformations that should be randomly sampled in the forward pass. <code>sample_rate=1.</code> defaults to all transformations being used in the wrapper. A smaller choice may be beneficial if memory constraints don't allow for the applications of all transformations in each forward pass.</td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="EquivarianceWrapper.mirror_input" class="doc_header"><code>EquivarianceWrapper.mirror_input</code><a href="dl4to/models.py#L885" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>EquivarianceWrapper.mirror_input</code>(<strong><code>x</code></strong>:<code>Tensor</code>, <strong><code>flip_dimensions</code></strong>:<code>list</code>)</p>
</blockquote>
<p>Returnes a <code>torch.Tensor</code>, which is a mirrored version of the input <code>x</code>.</p>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>x</code></strong></td>
<td><code>Tensor</code></td>
<td></td>
<td>The input that should be mirrored/flipped.</td>
</tr>
<tr>
<td><strong><code>flip_dimensions</code></strong></td>
<td><code>list</code></td>
<td></td>
<td>The dimension along which the input should be mirrored.</td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="EquivarianceWrapper.rotate_input" class="doc_header"><code>EquivarianceWrapper.rotate_input</code><a href="dl4to/models.py#L904" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>EquivarianceWrapper.rotate_input</code>(<strong><code>x</code></strong>:<code>Tensor</code>, <strong><code>rotations</code></strong>:<code>int</code>, <strong><code>plane</code></strong>:<code>list</code>)</p>
</blockquote>
<p>Returnes a <code>torch.Tensor</code>, which is a rotated version of the input <code>x</code>.</p>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>x</code></strong></td>
<td><code>Tensor</code></td>
<td></td>
<td>The input that should be rotated.</td>
</tr>
<tr>
<td><strong><code>rotations</code></strong></td>
<td><code>int</code></td>
<td></td>
<td>The number of 90° rations that should be performed. Four rotations result in the identity.</td>
</tr>
<tr>
<td><strong><code>plane</code></strong></td>
<td><code>list</code></td>
<td></td>
<td>On which plane the input should be rotated.</td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="EquivarianceWrapper.get_transforms" class="doc_header"><code>EquivarianceWrapper.get_transforms</code><a href="dl4to/models.py#L1015" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>EquivarianceWrapper.get_transforms</code>(<strong><code>sample_rate</code></strong>:<code>float</code>=<em><code>None</code></em>)</p>
</blockquote>
<p>Returns a list of all group actions that are applied to an input in the equivariance wrapper.</p>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>sample_rate</code></strong></td>
<td><code>float</code></td>
<td><code>None</code></td>
<td>The rate of transformations that should be randomly samples from the equivariance wrapper. <code>None</code> defaults to <code>equivariance_wrapper.sample_rate</code>. <code>1.</code> means that all transformations are considered.</td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="EquivarianceWrapper.__call__" class="doc_header"><code>EquivarianceWrapper.__call__</code><a href="dl4to/models.py#L1034" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>EquivarianceWrapper.__call__</code>(<strong><code>model</code></strong>:<code>Module</code>)</p>
</blockquote>
<p>Applies the equivariance wrapper to a <code>torch.nn.Module</code> model object and returns an <code>dl4to.models.EquivariantModel</code> object.</p>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>model</code></strong></td>
<td><code>Module</code></td>
<td></td>
<td>The model that should be turned into an equivariant model.</td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="EquivariantModel" class="doc_header"><code>class</code> <code>EquivariantModel</code><a href="dl4to/models.py#L1044" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>EquivariantModel</code>(<strong><code>model</code></strong>:<code>Module</code>, <strong><code>equivariance_wrapper</code></strong>:<code>dl4to.models.EquivarianceWrapper</code>) :: <code>Module</code></p>
</blockquote>
<p>A class that represents an equivariant model with respect to a specific equivariance wrapper.</p>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>model</code></strong></td>
<td><code>Module</code></td>
<td></td>
<td>A PyTorch neural network.</td>
</tr>
<tr>
<td><strong><code>equivariance_wrapper</code></strong></td>
<td><code>dl4to.models.EquivarianceWrapper</code></td>
<td></td>
<td>The equivariance wrapper that is applied to the model.</td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="EquivariantModel.__call__" class="doc_header"><code>EquivariantModel.__call__</code><a href="dl4to/models.py#L1057" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>EquivariantModel.__call__</code>(<strong><code>model_inputs</code></strong>:<code>Tensor</code>, <strong><code>sample_rate</code></strong>:<code>float</code>=<em><code>None</code></em>)</p>
</blockquote>
<p>The forward method for the equivariant model.</p>
<table>
<thead><tr>
<th></th>
<th>Type</th>
<th>Default</th>
<th>Details</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><code>model_inputs</code></strong></td>
<td><code>Tensor</code></td>
<td></td>
<td>The model inputs that are obtained as output of the preprocessing.</td>
</tr>
<tr>
<td><strong><code>sample_rate</code></strong></td>
<td><code>float</code></td>
<td><code>None</code></td>
<td>The rate of transformations that should be randomly samples from the equivariance wrapper. <code>None</code> defaults to <code>equivariance_wrapper.sample_rate</code>.<code>1.</code> means that all transformations are applied in the forward pass.</td>
</tr>
</tbody>
</table>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="References">References<a class="anchor-link" href="#References"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>[1] Dittmer, Sören, et al. "SELTO: Sample-Efficient Learned Topology Optimization." arXiv preprint arXiv:2209.05098 (2022).</p>
<p>[2] Puny, Omri, et al. "Frame averaging for invariant and equivariant network design." arXiv preprint arXiv:2110.03336 (2021).</p>

</div>
</div>
</div>
</div>
 

